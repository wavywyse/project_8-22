<script>
$(document).ready(function(){
	$('#date-input-2').datepicker({
		minDate: 0,
		dateFormat: "yy-mm-dd"
	});
})
</script>
  

<style>
	/*#map {*/
	    /*width: 85%;*/
	    /*height: 400px;*/
    /*}*/
    html, body {
  height: 100%;
  margin: 0;
}
#map{
  height: 400px;
  width: 400px;
  margin: 0;
}
</style>

<a href='/users/edit'>Settings</a>
<h1>Welcome <%=current_user.first_name%></h1>
<%= image_tag current_user.avatar.url %>

<div id='state-events-div'>
	<h3>Here are some of the events in your state</h3>
	<table>
		<thead>
			<tr>
				<th>Name</th>
				<th>Date</th>
				<th>Location</th>
				<th>Host</th>
				<th>Action/Status</th>
			</tr>
		</thead>
		<tbody>
		<% @state_events.each{ |event| %>
			<tr>
				<td><a href='/events/<%=event.id%>'><%=event.name%></a></td>
				<td><%=event.date%></td>
				<td><%=event.city%>, <%=event.state%></td>
				<td><a href='/users/<%=event.user_id%>'><%=find_user(event.user_id).first_name%></a></td>
				<td>
				<% if event.user_id == session[:user_id] %>
					<a href="/events/edit/<%=event.id%>">Edit</a>
					<a href="/events/destroy/<%=event.id%>">Delete</a>
				<% elsif event_join(event.id) %>
					<span>Joining</span>
					<a href="/events/unjoin/<%=event.id%>">Cancel</a>
				<% else %>
					<a href="/events/join/<%=event.id%>">Join</a>
				<% end %>
				</td>
			</tr>
		<% } %>
		</tbody>
	</table>
</div>

<div id='out-state-events-div'>
	<h3>Here are some of the events in other states</h3>
	<table>
		<thead>
			<tr>
				<th>Name</th>
				<th>Date</th>
				<th>Time</th>
				<th>Location</th>
				<th>Host</th>
				<th>Action</th>
			</tr>
		</thead>
		<tbody>
		<% @out_state_events.each{ |event| %>
			<tr>
				<td><a href='/events/<%=event.id%>'><%=event.name%></a></td>
				<td><%=event.date%></td>
				<td><%=event.time%></td>
				<td><%=event.city%>, <%=event.state%></td>
				<td><a href='/users/<%=event.user_id%>'><%=find_user(event.user_id).first_name%></td>
				<td>
				<% if event.user_id == session[:user_id] %>
					<a href="/events/edit/<%=event.id%>">Edit</a>
					<a href="/events/destroy/<%=event.id%>">Delete</a>
				<% elsif event_join(event.id) %>
					<span>Joining</span>
					<a href="/events/unjoin/<%=event.id%>">Cancel</a>
				<% else %>
					<a href="/events/join/<%=event.id%>">Join</a>
				<% end %>
				</td>
			</tr>
		<% } %>
		</tbody>
	</table>
</div>

<div id='new-event-div'>
<% if flash[:errors]
	flash[:errors].each{ |error| %>
		<p><%=error%></p>
	<% } 
end %>
	<form action='/events/create' method='post'>
		<input name="authenticity_token" value="<%= form_authenticity_token %>" type="hidden">
		<p>Name: <input type='text' name='event[name]'></p>
		<p>Date: <input type='date' name='event[date]' id='date-input-2'></p>
		<p>Time: <input type='time' name='event[time]'></p>
		<p>Location: <input type='text' name='event[city]'>
		<%= select_tag "state", options_for_select(us_states), :name => "event[state]" %>
		</p>
		<button>Add Event</button>
	</form>

    <h3>My Google Maps Demo</h3>
    <div id="map">

    </div>

</div>
<script src="https://maps.googleapis.com/maps/api/js?sensor=false&libraries=places"></script>
<input type="text" id="autocomplete">
<div id="map"></div>

<script>var mapOptions = {
    center: new google.maps.LatLng(34.052235,-118.243683),
    zoom: 12,
    mapTypeId: google.maps.MapTypeId.ROADMAP
};

var map = new google.maps.Map(document.getElementById('map'), mapOptions);
var acOptions = {
  types: ['establishment']
};
var autocomplete = new google.maps.places.Autocomplete(document.getElementById('autocomplete'),acOptions);
autocomplete.bindTo('bounds',map);
var infoWindow = new google.maps.InfoWindow();
var marker = new google.maps.Marker({
  map: map
});

google.maps.event.addListener(autocomplete, 'place_changed', function() {
  infoWindow.close();
  var place = autocomplete.getPlace();
  if (place.geometry.viewport) {
    map.fitBounds(place.geometry.viewport);
  } else {
    map.setCenter(place.geometry.location);
    map.setZoom(17);
  }
  marker.setPosition(place.geometry.location);
  infoWindow.setContent('<div><strong>' + place.name + '</strong><br>');
  infoWindow.open(map, marker);
  google.maps.event.addListener(marker,'click',function(e){

    infoWindow.open(map, marker);

  });
});
</script>
